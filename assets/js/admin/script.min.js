jQuery(document).ready((function(t){function e(){t(".mtphr-galleries-add-external").slideUp((function(){t(".mtphr-galleries-add-external-input input").val(""),t(".mtphr-galleries-add-external-submit a").removeAttr("type"),t(".mtphr-galleries-add-external-submit").find("span, i").hide()}))}function r(){t(".mtphr-galleries-thumbnails").find(".mtphr-gallery-thumbnail").each((function(e){t(this).find("input, select").each((function(){var r=t(this).attr("data-prefix"),a=t(this).attr("data-param");t(this).attr("name",r+"["+e+"]["+a+"]")}))}))}t("#mtphr-galleries-page-tabs").tabs({active:0}),t(".mtphr-galleries-thumbnails").sortable({items:".mtphr-gallery-thumbnail",helper:function(e,r){var a=r.children(),i=r.clone();return i.children().each((function(e){t(this).width(a.eq(e).width()),t(this).height(a.eq(e).height())})),i},update:function(){r()}}),t("body").on("click",".mtphr-gallery-thumbnail-delete",(function(e){e.preventDefault();var r=t(this).parents(".mtphr-galleries-thumbnails"),a=r.siblings(".mtphr-galleries-add-buttons"),i=r.data("single");t(this).parents(".mtphr-gallery-thumbnail").fadeOut((function(){t(this).remove(),i&&a.show()}))})),t(".mtphr-galleries-add-image").click((function(a){a.preventDefault(),e();var i=t(this).parent(),l=i.siblings(".mtphr-galleries-thumbnails").find("tr"),s=t(this).data("prefix"),n=t(this).data("single"),p;if(!p)return(p=wp.media({title:mtphr_galleries_vars.img_title,button:{text:mtphr_galleries_vars.img_button,size:"small"},multiple:!n,library:{type:"image"}})).on("select",(function(){n&&i.hide();var t=p.state().get("selection").toJSON();if(t.length>0){var e={action:"mtphr_gallery_thumb_ajax",type:"field",name_resources:s,attachments:t,security:mtphr_galleries_vars.security};jQuery.post(ajaxurl,e,(function(t){l.append(t),r()}))}})),p.open(),!1;p.open()})),t(".mtphr-galleries-add-video").click((function(a){a.preventDefault(),e();var i=t(this).parent(),l=i.siblings(".mtphr-galleries-thumbnails").find("tr"),s=t(this).data("prefix"),n=t(this).data("single"),p;if(!p)return(p=wp.media({title:mtphr_galleries_vars.video_title,button:{text:mtphr_galleries_vars.video_button,size:"small"},multiple:!n,library:{type:"video"}})).on("select",(function(){n&&i.hide();var t=p.state().get("selection").toJSON();if(t.length>0){var e={action:"mtphr_gallery_thumb_ajax",type:"field",name_resources:s,attachments:t,security:mtphr_galleries_vars.security};jQuery.post(ajaxurl,e,(function(t){l.append(t),r()}))}})),p.open(),!1;p.open()})),t(".mtphr-galleries-add-audio").click((function(a){a.preventDefault(),e();var i=t(this).parent(),l=i.siblings(".mtphr-galleries-thumbnails").find("tr"),s=t(this).data("prefix"),n=t(this).data("single"),p;if(!p)return(p=wp.media({title:mtphr_galleries_vars.audio_title,button:{text:mtphr_galleries_vars.audio_button,size:"small"},multiple:!n,library:{type:"audio"}})).on("select",(function(){n&&i.hide();var t=p.state().get("selection").toJSON();if(t.length>0){var e={action:"mtphr_gallery_thumb_ajax",type:"field",name_resources:s,attachments:t,security:mtphr_galleries_vars.security};jQuery.post(ajaxurl,e,(function(t){l.append(t),r()}))}})),p.open(),!1;p.open()})),t(".mtphr-galleries-add-external-submit a").click((function(a){a.preventDefault();var i=t(this).parents(".mtphr-galleries-add-external"),l=i.siblings(".mtphr-galleries-add-buttons"),s=i.siblings(".mtphr-galleries-thumbnails").find("tr"),n=t(this).attr("type"),p=t(this).siblings(".spinner"),h=t(this).siblings(".mtphr-galleries-add-external-error"),u=t(this).parent().prev().children("input").val(),o=t(this).attr("href"),m=t(this).data("prefix"),d=t(this).data("single");o=o.substr(1,o.length),h.hide(),p.show(),p.css("visibility","visible"),d&&l.hide();var g={action:"mtphr_gallery_external_thumb_ajax",type:n,value:u,parent:o,name_resources:m,security:mtphr_galleries_vars.security};jQuery.post(ajaxurl,g,(function(t){p.hide(),"error"===t?h.css("display","inline-block"):(s.append(t),e(),r())}))})),t("body").on("click",".mtphr-galleries-update-poster-button",(function(e){e.preventDefault();var a=t(this).parents(".mtphr-galleries-admin-thumb"),i=a.siblings(".mtphr-galleries-poster"),l=t(this).children(".mtphr-gallery-spinner-small"),s=a.siblings(".mtphr-galleries-type").val(),n=a.siblings(".mtphr-galleries-id").val(),p=t(this).attr("href");p=p.substr(1,p.length),l.show();var h={action:"mtphr_gallery_create_external_thumb_ajax",type:s,value:n,poster:i.val(),parent:p,security:mtphr_galleries_vars.security};jQuery.post(ajaxurl,h,(function(e){if(e){var s=t(e);i.val(s.attr("alt")),a.html(s),r(),l.hide()}}))})),t(".mtphr-galleries-add-youtube").click((function(r){r.preventDefault(),e();var a=t(this).parent().siblings(".mtphr-galleries-add-external"),i=a.find(".mtphr-galleries-add-external-title"),l=a.find(".mtphr-galleries-add-external-input input"),s=a.find(".mtphr-galleries-add-external-submit").children("a");i.text(mtphr_galleries_vars.youtube_input_title),s.attr("type","youtube"),l.focus(),a.slideDown((function(){l.focus()}))})),t(".mtphr-galleries-add-vimeo").click((function(r){r.preventDefault(),e();var a=t(this).parent().siblings(".mtphr-galleries-add-external"),i=a.find(".mtphr-galleries-add-external-title"),l=a.find(".mtphr-galleries-add-external-input input"),s=a.find(".mtphr-galleries-add-external-submit").children("a");i.text(mtphr_galleries_vars.vimeo_input_title),s.attr("type","vimeo"),a.slideDown((function(){l.focus()}))})),t("body").on("click",".mtphr-galleries-poster-button.add-poster",(function(e){e.preventDefault();var r=t(this).parents(".mtphr-galleries-admin-thumb"),a=r.siblings(".mtphr-galleries-poster"),i=t(this).attr("data-prefix"),l;if(!l)return(l=wp.media({title:mtphr_galleries_vars.poster_title,button:{text:mtphr_galleries_vars.poster_button,size:"small"},multiple:!1,library:{type:"image"}})).on("select",(function(){var e=l.state().get("selection").toJSON();if(e.length>0){a.val(e[0].id),t(this).removeClass("add-poster").addClass("remove-poster");var s={action:"mtphr_gallery_thumb_ajax",type:"thumbnail",name_resources:i,attachments:e,security:mtphr_galleries_vars.security};jQuery.post(ajaxurl,s,(function(t){var e=t;e+='<a class="mtphr-galleries-poster-button remove-poster" href="#">'+mtphr_galleries_vars.remove_poster+"</a>",r.html(e)}))}})),l.open(),!1;l.open()})),t("body").on("click",".mtphr-galleries-poster-button.remove-poster",(function(e){e.preventDefault();var r=t(this).parents(".mtphr-galleries-admin-thumb"),a=r.siblings(".mtphr-galleries-poster"),i=r.siblings(".mtphr-galleries-type").val();t(this).removeClass("remove-poster").addClass("add-poster"),a.val("");var l='<i class="mtphr-galleries-icon-'+i+'"></i>';l+='<a class="mtphr-galleries-poster-button add-poster" href="#">'+mtphr_galleries_vars.add_poster+"</a>",r.html(l)}))}));